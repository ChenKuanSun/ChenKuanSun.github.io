{"title":"LIFF 與 Angular 共舞 — 實作 — 01","date":"2019-06-10T16:46:25.000Z","date_formatted":{"ll":"Jun 11, 2019","L":"06/11/2019","MM-DD":"06-11"},"thumbnail":"https://cdn-images-1.medium.com/max/2000/1*GKBCjnvRhgCofYgCcFpShQ.png","link":"2019/06/11/LIFF_01","comments":true,"tags":["Angular","LIFF","LINE"],"categories":["LINE Developer"],"updated":"2020-04-13T23:55:01.576Z","content":"<p>上上週去LINE Developers Meetup參加了LINE新的技術分享會，除了超級好吃的食物跟超棒的場地外，不外乎就是一堆神人分享技術，跟超正主持人（？），根本是視覺味覺饗宴。</p>\n<img src=\"https://cdn-images-1.medium.com/max/2000/1*GKBCjnvRhgCofYgCcFpShQ.png\" style=\"max-width: 100%;\"><p>LIFF 全名是 <strong>LINE Front-end Framework，是用來打造一些在LINE聊天室內打開的Web App平台。由於剛推出沒有很久，似乎還沒有很多人意識到這個平台的價值性，現在還可以結合LINE Things控制IOT物聯網，結合SPA網頁做官方帳號額外LINE功能擴充等等。</strong></p>\n<h2 id=\"實作：\">實作：<a href=\"#實作：\" title=\"實作：\"></a></h2><p><strong>這邊帶大家實做一遍用Angular 結合這次<a href=\"https://www.facebook.com/will.fans\" target=\"_blank\">LINE API Expert — Will 保哥</a>打造的LIFF Code Snippets套件打造一個完整的LIFF Web APP。</strong></p>\n<h3 id=\"這邊我們從建立一個-angular-app-開始：\">這邊我們從建立一個 Angular APP 開始：<a href=\"#這邊我們從建立一個-angular-app-開始：\" title=\"這邊我們從建立一個 Angular APP 開始：\"></a></h3><img src=\"https://cdn-images-1.medium.com/max/2000/1*FL121PdI-JiB8Eobrjg4rQ.png\" style=\"max-width: 100%;\"><p>首先打開VS Code，然後假設大家都會基本的Angular，新增一個ng專案</p>\n<pre><code>ng new liff-app</code></pre><p>進入資料夾之後，下載保哥打造的擴充套件<a href=\"https://marketplace.visualstudio.com/items?itemName=doggy8088.liff-snippets\" target=\"_blank\">LIFF Snippets</a>，也可以直接到擴充套件輸入保哥搜尋，通常是前幾個。</p>\n<img src=\"https://cdn-images-1.medium.com/max/2000/1*EpOrXHnVqmCCGElMvwqIYw.png\" style=\"max-width: 100%;\"><p>打開之後可以看到保哥的說明：</p>\n<img src=\"https://cdn-images-1.medium.com/max/4052/1*XWj54h53Mb2dudGWnmaUAQ.png\" style=\"max-width: 100%;\"><p>進到專案裡面要先先到index.html加入一行liffsdk，這樣才可以執行LIFF相關套件，只要輸入liff</p>\n<img src=\"https://cdn-images-1.medium.com/max/3424/1*051X1IDwOh-y2gOIMVY9uw.png\" style=\"max-width: 100%;\"><p>就會出現Code Snippet，就會自動填入下面這個套件</p>\n<pre><code>&lt;script src=&quot;https://d.line-scdn.net/liff/1.0/sdk.js&quot;&gt;&lt;/script&gt;</code></pre><img src=\"https://cdn-images-1.medium.com/max/3088/1*DvAxXF9pwgtPVEVsdS-XMw.png\" style=\"max-width: 100%;\"><p>在app資料夾底下加入app.d.ts檔案（根據使用狀況而定），在裡面打liff之後會看到擴充套件帶來的方便之處，建議清單</p>\n<img src=\"https://cdn-images-1.medium.com/max/4052/1*o-fbUglERenv939PLnWxDg.png\" style=\"max-width: 100%;\"><p>這時候點liff-tsd</p>\n<img src=\"https://cdn-images-1.medium.com/max/2026/1*sUnBlPl4DWK8XLZhH3afqg.png\" style=\"max-width: 100%;\"><p>Magic!!保哥已經幫大家打好型別定義了。覺得神奇可以去點<a href=\"https://marketplace.visualstudio.com/items?itemName=doggy8088.liff-snippets\" target=\"_blank\">五顆星</a>給保哥支持一下嚕。</p>\n<p>接下來進入component的TS檔我們先來定義一個profile，型別是LIFFUserProfile</p>\n<img src=\"https://cdn-images-1.medium.com/max/3560/1*lW0BIuVCW2LbTke2i87ujw.png\" style=\"max-width: 100%;\"><p>要開始使用LIFF就要先把liff加到初始化裡，這時在OnInit一樣打入liff</p>\n<img src=\"https://cdn-images-1.medium.com/max/3560/1*WOkYzEwj_dmfJ_QVbFAr-g.png\" style=\"max-width: 100%;\"><p>由於我們是要拿使用者資料，所以點選profile，事實上沒有要取得使用者資料的話點上面那個 liff-init 就可以了。</p>\n<img src=\"https://cdn-images-1.medium.com/max/3248/1*rOldfrDa_6JZADfahYdOmA.png\" style=\"max-width: 100%;\"><p>註解裡都有API詳解網址跟可以取得的各Data屬性，還可以獲知當前View的大小（通常是你自己在LIFF Channel設定的除非這個網頁有不同的Liff APP進入點，就可以根據View等等屬性切換功能）</p>\n<img src=\"https://cdn-images-1.medium.com/max/3088/1*vtmA_9fggV-FC1FJGuinfg.png\" style=\"max-width: 100%;\"><p>接下來我們實作一下，如果我叫CK Sun，就會跟我說Hello，如果我不是CK Sun，就會跟我說HI。</p>\n<img src=\"https://cdn-images-1.medium.com/max/3500/1*-BsNKDGEin0Ktay-owAAeg.png\" style=\"max-width: 100%;\"><p>由於型別定義的關係，我們在Template輸入變數的時候就會很方便讓我們選擇。</p>\n<p>這樣基本的程式碼已經完成，但在LIFF裡有個限制就是Endpoint必須是Https開頭的加密網址（如果你都會設定就直接跳到LIFF環境設定），這時候我們方便開發就會推薦大家裝一個東西：<a href=\"https://ngrok.com/\" target=\"_blank\">Ngrok</a>，按照指示註冊安裝完之後，把下載的ngrok加入環境變數，事實上Mac使用者可以用</p>\n<pre><code>brew cask install ngrok</code></pre><p>直接安裝（記得在官網複製Token值設定），然後推薦大家直接裝live-server來啟動伺服器，如果直接用ng-serve，請記得用— disable-host-check來避免用不同host進入Angular App阻擋的問題。</p>\n<pre><code>ng serve --disable-host-check</code></pre><p>live-server安裝方式很簡單：</p>\n<pre><code>npm install -g live-server</code></pre><p>啟動伺服器之前要先Build專案，輸入以下指令來執行</p>\n<pre><code>ng build --prod</code></pre><p>接下來Angular CLI會在dist資料夾底下建立好專案的production版，直接打下面這行（記得替換<strong>{app-name}成你的app名字）在</strong>liveserver<strong>上執行</strong></p>\n<pre><code>live-server dist/**{app-name}**/</code></pre><p>會出現網址代表成功</p>\n<img src=\"https://cdn-images-1.medium.com/max/2372/1*6YJ0-lO_dad-pT4jv4X-xg.png\" style=\"max-width: 100%;\"><p>接下來就是用ngrok導向本地端伺服器，8080是根據開起來的port</p>\n<pre><code>ngrok http 8080</code></pre><p>成功會出現：</p>\n<img src=\"https://cdn-images-1.medium.com/max/2372/1*EToN2ZvTDCU-HbORBNOi8Q.png\" style=\"max-width: 100%;\"><p>可以先打開https開頭網址測試是否有連線成功。並記好這段連結。</p>\n<h3 id=\"接下來進入liff環境設定階段：\">接下來進入LIFF環境設定階段：<a href=\"#接下來進入liff環境設定階段：\" title=\"接下來進入LIFF環境設定階段：\"></a></h3><p>首先進入<a href=\"https://developers.line.biz\" target=\"_blank\">LINE Developers</a>然後點選登入，第一次登入的會要求你註冊開發者的登錄資訊。</p>\n<img src=\"https://cdn-images-1.medium.com/max/10240/1*ThB0WG2Qgs_bNwg0UhGmFw.png\" style=\"max-width: 100%;\">\n*[LINE Developers](https://developers.line.biz)*<p>登入之後，可以看到後台頁面，由於我已經創建一個LINE channel，所以頁面中會有，沒有的人請按<a href=\"https://developers.line.biz/console/register/provider/\" target=\"_blank\">**Create New Provider</a>，接下來會出現**</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2396/1*rKFz2GBFnGtXtetig3MfvQ.png\" style=\"max-width: 100%;\"><em>點選Messaging API</em></p>\n<p>請先點選Messaging API頻道來創建頻道。接下來跟著說明把資訊填入之後，創建完之後進入剛創建完的Channel頁面</p>\n<img src=\"https://cdn-images-1.medium.com/max/5108/1*0QogJ8gn91nxKgLUfliRgg.png\" style=\"max-width: 100%;\"><p>並往下滑到底會有QR Code可以自己加入機器人。</p>\n<img src=\"https://cdn-images-1.medium.com/max/2250/1*F2yFSS45W2qinZoyeqbvoQ.png\" style=\"max-width: 100%;\"><p>掃完之後可以加入自己的機器人，可以說個 Hello，然後在QR Code下面有個Basic ID，可以透過下面連結到管理頁面。可以點選聊天TAB（聊天模式請從機器人改成聊天訊息）可以跟自己對話。</p>\n<pre><code>[https://manager.line.biz/account/](https://manager.line.biz/account/)@你的機器人ID</code></pre><p>，回到剛剛的Channel頁面然後點選LIFF TAB</p>\n<img src=\"https://cdn-images-1.medium.com/max/3932/1*vBNmE2zo7SU60EDz0ZK0kw.png\" style=\"max-width: 100%;\"><img src=\"https://cdn-images-1.medium.com/max/4542/1*ox2AfGpcWBEItaKKSXd31g.png\" style=\"max-width: 100%;\"><p>可以看到新增的頁面，然後點<strong>Create a new LIFF App創建新的Web App</strong></p>\n<img src=\"https://cdn-images-1.medium.com/max/2000/1*z3WqSiV7cGi47CGLizjgcA.png\" style=\"max-width: 100%;\"><p>可以看到有三個Size，分別是Full，Tall，Compact，如下圖</p>\n<img src=\"https://cdn-images-1.medium.com/max/2250/1*ZmRT7cXQMj_NZCTHuBObsA.png\" style=\"max-width: 100%;\"><img src=\"https://cdn-images-1.medium.com/max/2250/1*AOUmS9PKOyqjPbqyWsQomg.png\" style=\"max-width: 100%;\"><p>![由左至右Full，Tall，Compact](<a href=\"https://cdn-images-1.medium.com/max/2250/1*k3P04u1pSpgDaNlYRhwkMA.png&quot;\" target=\"_blank\">https://cdn-images-1.medium.com/max/2250/1*k3P04u1pSpgDaNlYRhwkMA.png&quot;</a> style=”max-width: 100%;”&gt;<em>由左至右Full，Tall，Compact</em></p>\n<p>輸入Endpoint，就是上面我們Ngrok提供的網址或是你自己的網站也可以 。BLE的部分等有實做的時候再來講解，先丟概念圖：</p>\n<img src=\"https://cdn-images-1.medium.com/max/3762/1*OEN2nybLe3UQUEDOeU2kiQ.png\" style=\"max-width: 100%;\"><p>就是一個支援外連裝置的應用，可以做一些Web APP驗證完使用者的UserID然後就透過BLE方式啟動藍牙裝置等等。</p>\n<p>接下來點選確認之後，複製LIFF URL後面的line://app/xxxx。到<a href=\"https://manager.line.biz/account/\" target=\"_blank\">聊天機器人的頁面</a>點選聊天，把URL貼給自己，打開它</p>\n<img src=\"https://cdn-images-1.medium.com/max/2250/1*U6sNMN4XqjXuF9b4-Rl7rA.png\" style=\"max-width: 100%;\"><p>會先驗證是否讓Web App取得資料按下許可就會進入APP如下圖所示：</p>\n<img src=\"https://cdn-images-1.medium.com/max/2250/1*iYZ23yk0h5dKl-tXF6PSJQ.png\" style=\"max-width: 100%;\"><img src=\"https://cdn-images-1.medium.com/max/2250/1*jdlH3BcbvEpVSqudTvm01A.png\" style=\"max-width: 100%;\"><p>由於我們剛剛程式有設定好：</p>\n<img src=\"https://cdn-images-1.medium.com/max/3088/1*vtmA_9fggV-FC1FJGuinfg.png\" style=\"max-width: 100%;\"><p>如果是CK Sun就說Hello，如果不是完全符合的就說Hi，</p>\n<p>接下來試著取看看其他資料如UserID</p>\n<img src=\"https://cdn-images-1.medium.com/max/2000/1*tTDrzqzcu-n9BpHHlarwJQ.png\" style=\"max-width: 100%;\"><p>再來開啟測試：</p>\n<img src=\"https://cdn-images-1.medium.com/max/2250/1*jYQl0JEY7nfejvox0DqLWA.png\" style=\"max-width: 100%;\"><p>這樣就可以試著做其他應用用途，實際上API還有很多種，有興趣的人可以到<a href=\"https://developers.line.biz/en/reference/liff/\" target=\"_blank\">LIFF API reference</a>t查詢。</p>\n<h3 id=\"angular-與-liff-共舞-line-developer-meetup保哥上課keynote\"><a href=\"https://www.slideshare.net/WillHuangTW/angular-and-liff-147428212\" target=\"_blank\">Angular 與 LIFF 共舞 (LINE Developer Meetup)保哥上課Keynote</a><a href=\"#angular-與-liff-共舞-line-developer-meetup保哥上課keynote\" title=\"Angular 與 LIFF 共舞 (LINE Developer Meetup)保哥上課Keynote\"></a></h3><h3 id=\"stackblitz範例連結\">Stackblitz範例連結<a href=\"#stackblitz範例連結\" title=\"Stackblitz範例連結\"></a></h3><p><a href=\"https://stackblitz.com/edit/angular-liff-demo?embed=1&file=src/app/app.component.ts\" target=\"_blank\"><strong>angular-liff-demo - StackBlitz</strong><br><em>Starter project for Angular apps that exports to the Angular CLI</em>stackblitz.com</a></p>\n<h2 id=\"結語\">結語<a href=\"#結語\" title=\"結語\"></a></h2><p>目前簡易的應用可以先介紹到這邊，目前正在構思如何在LIFF Web App 導入TF.js的好玩應用，讓大家玩玩在手機上跑應用然後丟訊息到聊天室的做法。能夠這麼迅速開發還是要感謝<a href=\"https://www.facebook.com/will.fans\" target=\"_blank\">**LINE API Expert — Will 保哥</a>**打造的<a href=\"https://marketplace.visualstudio.com/items?itemName=doggy8088.liff-snippets\" target=\"_blank\">LIFF Snippets</a>能夠很方便的取得各種需要的資訊，減少去翻文檔的次數，如果這些文章有幫到你的話請多給我掌聲，如果覺得工具非常好用的話可以去<a href=\"https://marketplace.visualstudio.com/items?itemName=doggy8088.liff-snippets\" target=\"_blank\">LIFF Snippets</a>頁面點五顆星，大家有更實用的TF建議應用可以發信給我構思。</p>\n<p>如果本篇文章有幫到你的忙，<br>選單的<a href=\"https://www.paypal.me/ChenKuanSun\" target=\"_blank\">Donate</a>可以請我喝一杯英式紅茶拿鐵，<br>讓我有更多的咖啡因(X)</p>\n","prev":{"title":"AWS Deepracer RL競賽實戰心得分享","link":"2019/06/13/AWS_DeepRacer"},"next":{"title":"JupyterNotebook with Anaconda 導入Module老問題","link":"2019/02/03/JupyterNotebook"},"plink":"https://chenkuansun.github.io/2019/06/11/LIFF_01/","toc":[{"id":"實作：","title":"實作：","index":"1","children":[{"id":"這邊我們從建立一個-angular-app-開始：","title":"這邊我們從建立一個 Angular APP 開始：","index":"1.1"},{"id":"接下來進入liff環境設定階段：","title":"接下來進入LIFF環境設定階段：","index":"1.2"},{"id":"angular-與-liff-共舞-line-developer-meetup保哥上課keynote","title":"Angular 與 LIFF 共舞 (LINE Developer Meetup)保哥上課Keynote","index":"1.3"},{"id":"stackblitz範例連結","title":"Stackblitz範例連結","index":"1.4"}]},{"id":"結語","title":"結語","index":"2"}]}